<html>
    <head>
        <title>Garlicoin Pool Miner Stats</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
        <script>
            $.holdReady(true);
            var data;

            var miner = getParameterByName('miner');

            $.getJSON("http://5.196.13.45:4000/api/pools/grlc1/miner/" + miner + "/stats", function(localData){
                data = localData;
                $('#pendingShares').text(data.pendingShares);
                $('#pendingBalances').text(data.pendingBalances);
                $('#totalPaid').text(data.totalPaid);
                $('#totalHashrate').text(getTotalHashrate(data));
                if(typeof(data.lastPayment) != 'undefined'){
                    $('#lastPayment').text("");
                    var workingLastPaymentLink = "http://5.196.13.45:3001/tx/" + data.lastPaymentLink.split("/")[4];
                    $('#lastPayment').append("<a target='_blank' href='" + workingLastPaymentLink + "'>" + data.lastPayment + "</a>");
                }
                var workers = Object.keys(data.performance.workers);
                for(var i = 0; i < workers.length; i++){
                    if(workers[i] == "") appendWorker("[unnamed]", i);
                    else appendWorker(workers[i], i);
                }
                if(workers[0] == "") $('#workerName').text("[unnamed]");
                else $('#workerName').text(workers[0]);
                $('#workerHashrate').text(parseInt(data.performance.workers[workers[0]].hashrate)/1000 + " KH/s");
                $('#workerSharesPerSecond').text(data.performance.workers[workers[0]].sharesPerSecond);
                $.holdReady(false);
            });

            $(document).ready(function(){
                $('#headerDisplay').html("<mark><b>" + miner + "</b></mark>");
                $('.dropdown-menu').on('click', 'a', function(){
                    updateWorker($(this).attr('listid'));
                });
            });

            function appendWorker(name, listid){
                $('#dropdown').append('<a listid=' + listid + ' class="dropdown-item" href="#">' + name + '</a>')
            }

            function updateWorker(arrayID){
                var workers = Object.keys(data.performance.workers);
                if(workers[arrayID] == "") $('#workerName').text("[unnamed]");
                else $('#workerName').text(workers[arrayID]);
                $('#workerHashrate').text(parseInt(data.performance.workers[workers[arrayID]].hashrate)/1000 + " KH/s");
                $('#workerSharesPerSecond').text(data.performance.workers[workers[arrayID]].sharesPerSecond);
            }

            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            function getTotalHashrate(data){
                var sum = 0;
                var workers = Object.keys(data.performance.workers);
                for(var i = 0; i < workers.length; i++){
                    sum += data.performance.workers[workers[i]].hashrate;
                }
                return sum / 1000 + " KH/s";
            }
        </script>
        <style>
            .vertical-center{
                min-height: 100%;
                min-height: 100vh;

                display: flex;
                align-items: center;
            }

            .card-inverse{
                color: #f3f3f3
            }

        </style>
    </head>
    <body>
    <div class="vertical-center">
        <div class="container text-center">
            <div class="card align-middle">
                <div class="card-header">
                    <span id="headerDisplay"></span>
                </div>
                <div class="card-body text-left">
                    <div class="card-block">
                        <h4 class="card-title">General</h4>
                        <div style="background: #333;" class="card-body rounded card-inverse">
                            <p>Pending shares: <mark id="pendingShares">0</mark></p>
                            <p>Pending balances: <mark id="pendingBalances">0.0</mark></p>
                            <p>Total paid: <mark id="totalPaid">0.0</mark></p>
                            <p>Total hashrate: <mark id="totalHashrate">0.0</mark></p>
                            <p>Last payment: <mark id="lastPayment">Has never been paid</mark></p>
                        </div>
                    </div>
                    <hr>
                    <h4 class="card-title">Workers</h4>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select a worker
                        </button>
                        <div id="dropdown" class="dropdown-menu">
                        </div>
                    </div>
                    <div style="background-color:#333;margin-top:1em" class="card-body rounded card-inverse">
                        <p>Name: <mark id="workerName">Worker</mark></p>
                        <p>Hashrate: <mark id="workerHashrate">0</mark></p>
                        <p>Shares/second: <mark id="workerSharesPerSecond">0</mark></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </body>
</html>